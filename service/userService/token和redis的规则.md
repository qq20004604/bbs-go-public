## token和redis的规则

### 1. redis

#### 1.1 数据

用户登录后，其token和用户ID（用户ID是根据规则生成的固定值）这两个值，分别作为键值对，写入 redis

同一个用户，不同次登录，其token不同，但是 用户ID 必然相同。

1. 第一组的key是token，其值是用户ID
2. 第二组的key是用户ID，其值是token
3. 注意无论是token还是用户ID，都是指定规则生成的，具体可以查看代码

默认情况下，格式如下：

```
token的格式是：bbs-[随机生成的唯一KEY]
用户ID的格式是：AUTH-PC-BBS-USERID-[用户ID]
```

#### 1.2 登录时唯一性验证

在生成token后，需要去redis里查询是否有相同token，

目前设置为，创建token后，会查重，如果重复会重新创建，该操作会重复三次。如果三次都重复（理论上第一次创建就重复的概率就极其低，低到不可能了），则会报错。

然后会将这两组键值对（参考1.1）写入 redis，并将 token 和 用户信息 返回给用户

写入之前，会根据用户ID去查询 redis 现存数据，如果能查询到（说明用户之前登录过），则清空之前的登录状态（删除redis里的数据）。
